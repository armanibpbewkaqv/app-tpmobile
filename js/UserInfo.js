(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["UserInfo"],{"14a0":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-info-container"},[a("van-nav-bar",{staticClass:"app-nav-bar",attrs:{title:e.$t("userInfo.title")}},[a("div",{attrs:{slot:"left"},slot:"left"},[a("i",{staticClass:"iconfont icon-fanhui",on:{click:function(t){return e.$router.go(-1)}}})])]),a("div",{staticClass:"user-image-parent-wrap"},[a("van-cell",{staticClass:"user-image-wrap",attrs:{title:e.$t("userInfo.avatar"),"is-link":""}},[[a("van-image",{staticClass:"user-image",attrs:{round:"",src:e.imageFile?e.imageFile:e.userImage}})]],2),a("input",{ref:"imageHeader",attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:e.selectedImage}})],1),a("van-cell",{attrs:{title:e.$t("address.email"),"is-link":"",value:e.userInfo.email},on:{click:function(t){return e.showEditPop(3)}}}),a("van-cell",{attrs:{title:e.$t("login.nickName"),"is-link":"",value:e.userInfo.firstName},on:{click:function(t){return e.showEditPop(1)}}}),a("van-cell",{attrs:{title:e.$t("userInfo.sex"),"is-link":"",value:e.sexText},on:{click:function(t){e.showSexPop=!0}}}),a("van-popup",{style:{height:"100%",width:"100%",margin:"-1px"},model:{value:e.showNamePanel,callback:function(t){e.showNamePanel=t},expression:"showNamePanel"}},[a("EditNamePanel",{key:(new Date).getTime(),attrs:{data:e.editData,close:e.hideEditPop},on:{transferInfo:e.receiveName}})],1),a("van-popup",{style:{width:"100%"},attrs:{position:"bottom"},model:{value:e.showSexPop,callback:function(t){e.showSexPop=t},expression:"showSexPop"}},[a("van-picker",{attrs:{title:e.$t("userInfo.sex"),"show-toolbar":"","default-index":e.sexDefaultIndex,columns:e.sexData},on:{cancel:function(t){e.showSexPop=!1},confirm:e.onConfirm}})],1)],1)},s=[],i=(a("e7e5"),a("d399")),r=a("1da1"),o=(a("96cf"),a("d3b7"),a("25f0"),a("b0c0"),a("3ca3"),a("ddb0"),a("2b3d"),a("ac1f"),a("1276"),a("466d"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("c24f")),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"edit-name-container"},[a("van-nav-bar",{staticClass:"app-nav-bar",attrs:{title:e.editData.title}},[a("div",{attrs:{slot:"left"},slot:"left"},[a("i",{staticClass:"iconfont icon-fanhui",on:{click:e.close}})])]),a("van-field",{attrs:{clearable:""},model:{value:e.editData.value,callback:function(t){e.$set(e.editData,"value",t)},expression:"editData.value"}}),a("div",{staticClass:"btn-wrap"},[a("van-button",{staticClass:"save-btn",attrs:{size:"large"},on:{click:e.saveName}},[e._v(e._s(e.$t("common.save")))])],1)],1)},u=[],l={name:"EditNamePanel",props:{data:{type:Object},close:{type:Function}},data:function(){return{editData:JSON.parse(JSON.stringify(this.data))}},created:function(){},mounted:function(){},methods:{saveName:function(){this.$emit("transferInfo",this.editData.value)}}},f=l,d=(a("aac6"),a("2877")),m=Object(d["a"])(f,c,u,!1,null,"7b8b221d",null),h=m.exports,p=a("fa7d"),v={components:{EditNamePanel:h},data:function(){return{userInfo:JSON.parse(JSON.stringify(this.$store.state.user)),showNamePanel:!1,editData:null,showSexPop:!1,sexData:[{text:this.$t("userInfo.sexFamale"),value:"0"},{text:this.$t("userInfo.sexMale"),value:"1"}],imageFile:null,femaleHeader:a("7869"),maleHeader:a("257f")}},computed:{sexText:function(){return"0"===this.userInfo.sex.toString()?this.$t("userInfo.sexFamale"):this.$t("userInfo.sexMale")},sexDefaultIndex:function(){return"0"===this.userInfo.sex.toString()?0:1},userImage:function(){return this.userInfo&&this.userInfo.usrico?p["g"]+this.userInfo.usrico:this.userInfo&&"0"===this.userInfo.sex.toString()?this.femaleHeader:this.userInfo&&"1"===this.userInfo.sex.toString()?this.maleHeader:this.femaleHeader}},mounted:function(){},methods:{saveUserInfo:function(){var e=this,t=this.$refs.imageHeader.files[0];t?this.getImageBase64(t).then((function(a){e.updateImage(a,t.name)})):this.changeUserInfo()},changeUserInfo:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(o["r"])({userId:a.userInfo.userId,sex:4===e?t:a.userInfo.sex,firstName:3===e?t:a.userInfo.firstName,lastName:"",email:2===e?t:a.userInfo.email}).then((function(){i["a"].success(a.$t("common.modifySuccess")),1===e?a.userInfo.usrico=t:2===e?(a.userInfo.email=t,a.showNamePanel=!1):3===e?(a.userInfo.firstName=t,a.showNamePanel=!1):4===e&&(a.userInfo.sex=t,a.showSexPop=!1),a.$store.commit("setUser",a.userInfo)})).catch((function(e){i["a"].fail(e.data.msg)}));case 2:case"end":return n.stop()}}),n)})))()},showEditPop:function(e){var t=this.$t("login.nickName");3===e&&(t=this.$t("address.email"));var a=this.userInfo.firstName;3===e&&(a=this.userInfo.email),this.editData={type:e,title:t,value:a},this.showNamePanel=!0},hideEditPop:function(){this.showNamePanel=!1},receiveName:function(e){1===this.editData.type?this.changeUserInfo(3,e):3===this.editData.type&&this.changeUserInfo(2,e)},onConfirm:function(e){this.changeUserInfo(4,e.value)},selectedImage:function(){var e=this,t=window.URL||window.webkitURL,a=this.$refs.imageHeader.files[0];this.imageFile=t.createObjectURL(a),this.getImageBase64(a).then((function(t){e.updateImage(t,a.name)}))},updateImage:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var s,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=a.dataURLtoFile(e,t),r=new FormData,r.append("file",s),r.append("userId",a.$store.state.user.userId),n.next=6,Object(o["b"])(r).then((function(e){200===e.status&&"0"===e.data.code?a.changeUserInfo(1,e.data.data):i["a"].fail(a.$t("comment.updateImageFail"))}));case 6:case"end":return n.stop()}}),n)})))()},dataURLtoFile:function(e,t){var a=e.split(","),n=a[0].match(/:(.*?);/)[1],s=atob(a[1]),i=s.length,r=new Uint8Array(i);while(i--)r[i]=s.charCodeAt(i);return new File([r],t,{type:n})},getImageBase64:function(e){var t=new Promise((function(t,a){var n=new FileReader;n.onload=function(){var e=n.result;t(e)},n.readAsDataURL(e)}));return t}}},I=v,g=(a("4dd5"),Object(d["a"])(I,n,s,!1,null,"61261576",null));t["default"]=g.exports},"257f":function(e,t,a){e.exports=a.p+"img/user-male.png"},"4dd5":function(e,t,a){"use strict";a("9a01")},"60e3":function(e,t,a){},7869:function(e,t,a){e.exports=a.p+"img/user-female.png"},"9a01":function(e,t,a){},aac6:function(e,t,a){"use strict";a("60e3")}}]);