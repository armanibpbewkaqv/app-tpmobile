(window.webpackJsonp=window.webpackJsonp||[]).push([["SubmitComment"],{"063c":function(t,e,a){"use strict";a.d(e,"c",(function(){return c})),a.d(e,"g",(function(){return o})),a.d(e,"a",(function(){return u})),a.d(e,"f",(function(){return m})),a.d(e,"d",(function(){return l})),a.d(e,"b",(function(){return d})),a.d(e,"i",(function(){return f})),a.d(e,"h",(function(){return p})),a.d(e,"e",(function(){return g}));var n=a("b775"),r=a("cebe"),i=a.n(r),s=a("fa7d"),c=function(t){return Object(n.a)({url:"/getcommentsbyprd",data:t})},o=function(t){return i.a.post(s.a+"/uploadcommentimg",t,{headers:{"Content-Type":"multipart/form-data"}})},u=function(t){return Object(n.a)({url:"/delcommentimg",data:t})},m=function(t){return Object(n.a)({url:"/submitcomment",data:t})},l=function(t){return Object(n.a)({url:"/listordercartbycmtstatus",data:t})},d=function(t){return Object(n.a)({url:"/getcommentdetail",data:t})},f=function(t){return Object(n.a)({url:"/userprise",data:t})},p=function(t){return Object(n.a)({url:"/userleavemsg",data:t})},g=function(t){return Object(n.a)({url:"/leavemsgofcmt",data:t})}},"4cb2":function(t,e,a){"use strict";a("94f2")},"4f13":function(t,e,a){"use strict";a.r(e),a("e7e5");var n=a("d399"),r=a("1da1"),i=(a("e17f"),a("2241")),s=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("b0c0"),a("a434"),a("063c")),c=a("fa7d"),o={data:function(){return{productData:this.$route.query.product,productEval:5,content:"",imageFileList:[],serverImageUrlList:[],isAdditionalCommnet:!1,maxImageNumber:6,videoUrl:""}},mounted:function(){this.productData.cmId?this.isAdditionalCommnet=!0:this.isAdditionalCommnet=!1},beforeDestroy:function(){this.serverImageUrlList.length>0&&this.requestDeleteImage(this.serverImageUrlList)},methods:{selectedImage:function(){var t=this,e=window.URL||window.webkitURL,a=this.$refs.imageHeader.files,n=e.createObjectURL(a[0]);this.imageFileList.push(n);var r=Object(c.h)(a[0]);0===r?Object(c.i)(a[0]).then((function(e){t.updateImage(Object(c.j)(e,a[0].name))})):1===r&&this.updateImage(a[0])},deleteImage:function(t){var e=this;i.a.confirm({title:this.$t("comment.deleteImageTitle"),message:this.$t("comment.deleteImageDesc")}).then((function(){var a=[e.serverImageUrlList[t]];e.requestDeleteImage(a,t)})).catch((function(){}))},updateImage:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(r=new FormData).append("file",t),a.next=4,Object(s.g)(r).then((function(t){200===t.status&&"0"===t.data.code?(n.a.success(e.$t("comment.updateImageSuccess")),e.serverImageUrlList.push(t.data.data)):n.a.fail(e.$t("comment.updateImageFail"))}));case 4:case"end":return a.stop()}}),a)})))()},requestDeleteImage:function(t,e){var a=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(s.a)({inputParams:JSON.stringify(t)}).then((function(){e?(a.serverImageUrlList.splice(e,1),a.imageFileList.splice(e,1)):(a.serverImageUrlList=[],a.imageFileList=[])}));case 2:case"end":return n.stop()}}),n)})))()},submitComment:function(){if(this.content){var t={shareimgs:this.serverImageUrlList,sharevideo:"",videourl:this.videoUrl,orderId:this.productData.orderId,productId:this.productData.productId,productColorId:this.productData.productColorId,cmId:this.productData.cmId&&"0"!==this.productData.cmId?this.productData.cmId:null,attrDes:this.productData.attrDes,tEval:this.isAddComment?null:this.productEval,content:this.content,userId:this.$store.state.user.userId};this.requestSubmitCommit([t])}else Object(n.a)(this.$t("comment.emptyCommontHint"))},requestSubmitCommit:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(s.f)({inputParams:JSON.stringify(t)}).then((function(){n.a.success(e.$t("comment.submitSuccess")),e.serverImageUrlList=[],e.imageFileList=[],e.$router.go(-1)})).catch((function(){n.a.success(e.$t("comment.submitFail"))}));case 2:case"end":return a.stop()}}),a)})))()}}},u=(a("4cb2"),a("2877")),m=Object(u.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"product-comment-container"},[a("van-nav-bar",{staticClass:"app-nav-bar",attrs:{title:t.productData.productName,fixed:""}},[a("div",{attrs:{slot:"left"},slot:"left"},[a("i",{staticClass:"iconfont icon-fanhui",on:{click:function(e){return t.$router.go(-1)}}})]),a("div",{attrs:{slot:"right"},on:{click:t.submitComment},slot:"right"},[t._v(" "+t._s(t.$t("common.submitBtn"))+" ")])]),a("div",{staticClass:"product-comment-wrap"},[a("div",{staticClass:"rate-wrap"},[a("div",{staticClass:"label"},[t._v(t._s(t.$t("comment.productRateTitle")))]),a("div",{staticClass:"comment-rate-wrap"},[a("van-rate",{attrs:{color:"#ffd21e",size:18,"allow-half":"",readonly:t.isAdditionalCommnet},model:{value:t.productEval,callback:function(e){t.productEval=e},expression:"productEval"}})],1)]),a("div",{staticClass:"comment-content-wrap"},[a("van-field",{attrs:{rows:"5",clearable:"",type:"textarea",maxlength:"500",placeholder:t.$t("comment.commentContentPlaceholder"),"show-word-limit":""},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),a("div",{staticClass:"image-wrap"},[t._l(t.imageFileList,(function(e,n){return a("div",{key:n,staticClass:"image-item-wrap"},[a("van-image",{attrs:{src:e},scopedSlots:t._u([{key:"loading",fn:function(){return[a("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0}],null,!0)}),a("div",{staticClass:"close-icon",on:{click:function(e){return t.deleteImage(n)}}},[a("i",{staticClass:"iconfont icon-guanbi1"})])],1)})),!t.imageFileList||t.imageFileList.length<t.maxImageNumber?a("div",{staticClass:"image-item-wrap"},[a("i",{staticClass:"iconfont icon-paizhaopian"}),a("input",{ref:"imageHeader",attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:t.selectedImage}})]):t._e()],2),a("div",{staticClass:"video-wrap"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("comment.commentVideoTitle")))]),a("van-field",{attrs:{rows:"3",clearable:"",type:"textarea",placeholder:t.$t("comment.commentVideoPlaceholder")},model:{value:t.videoUrl,callback:function(e){t.videoUrl=e},expression:"videoUrl"}})],1)]),a("div",{staticClass:"btn-wrap"},[a("van-button",{staticClass:"submit-btn",attrs:{size:"large"},on:{click:t.submitComment}},[t._v(t._s(t.$t("common.submitBtn")))])],1)],1)}),[],!1,null,"4899b2f4",null);e.default=m.exports},"94f2":function(t,e,a){},a434:function(t,e,a){"use strict";var n=a("23e7"),r=a("23cb"),i=a("a691"),s=a("50c4"),c=a("7b0b"),o=a("65f0"),u=a("8418"),m=a("1dde")("splice"),l=Math.max,d=Math.min;n({target:"Array",proto:!0,forced:!m},{splice:function(t,e){var a,n,m,f,p,g,h=c(this),v=s(h.length),b=r(t,v),I=arguments.length;if(0===I?a=n=0:1===I?(a=0,n=v-b):(a=I-2,n=d(l(i(e),0),v-b)),v+a-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(m=o(h,n),f=0;f<n;f++)(p=b+f)in h&&u(m,f,h[p]);if(m.length=n,a<n){for(f=b;f<v-n;f++)g=f+a,(p=f+n)in h?h[g]=h[p]:delete h[g];for(f=v;f>v-n+a;f--)delete h[f-1]}else if(a>n)for(f=v-n;f>b;f--)g=f+a-1,(p=f+n-1)in h?h[g]=h[p]:delete h[g];for(f=0;f<a;f++)h[f+b]=arguments[f+2];return h.length=v-n+a,m}})}}]);